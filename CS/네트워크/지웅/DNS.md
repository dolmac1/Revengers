# DNS - 인터넷 디렉터리 서비스
일반적으로 호스트는 IP주소를 통해 식별하게 된다.
이러한 식별 IP를 인간이 다 외우고 다닐수는 없는 노릇이고, 그렇기에 이러한 IP에 호스트의 이름을 매칭시키는 것을 DNS라고 할수 있겠다.

# DNS가 제공하는 서비스
사람은 쉬운 호스트 이름 식별자를 좋아하지만, 라우터나 컴퓨터는 고정길이의 계층 구조를 가진 IP주소를 좋아한다.
이러한 선호 차이를 절충하기 위해, 호스트 네임을 IP주소로 변환해주는 디렉터리 서비스가 필요하다.

인터넷 DNS(Domain Name System)는 이러한 변환의 업무를 맡게 된다.
DNS의 정의는 다음과 같다.
1. DNS서버들의 계층 구조로 구현된 분산 데이터 베이스이다.
2. 호스트가 분산 데이터베이스로 질의하도록 허락하는 어플리케이션 계층 프로토콜이다.
3. DNS 서버는 주로, BIND소프트웨어를 수행하는 유닉스 컴퓨터이다. 
4. DNS프로토콜은 UDP상에서 수행되며, 포트 번호로는 53번을 이용한다.
5. DNS는 어플리케이션 프로토콜들이 HTTP, SMTP, FTP등을 사용자가 제공한 호스트네임을 IP주소로 변환하기 위해 이요한다.

DNS의 수행양식은 다음과 같다.
1. 같은 사용자 컴퓨터는 DNS어플리케이션의 클라이언트 측을 수행한다.
2. 브라우저는 URL로부터 호스트 네임을 추출하고, 그 호스트 네임을 DNS어플리케이션의 클라이언트 측에 넘긴다.
3. DNS클라이언트는 DNS서버로 호스트 네임을 포함하는 질의를 보낸다.
4. DNS클라이언트는 호스트 네임에 대한 IP주소 응답을 받는다.
5. 브라우저가 DNS로부터 IP주소를 받으면, 브라우저는 그 IP주소와 그 주소의 80번 포트에 위치하는 HTTP서버 프로세스로 TCP연결을 초기화 한다.

이러한 양식으로부터 DNS는 DNS를 사용하는 인터넷 어플리케이션에게 추가적인 지연을 줄수 있다는 것을 확인할 수 있다.
하지만, 다행이도 IP주소는 가까운 DNS서버에 캐싱되어있어서 평균 DNS지연 뿐 아니라, DNS네트워크 트래픽 감소에도 도움을 줄수 있다.

DNS호스트 네임을 IP주소로 변환하는 것 외에 다음과 같은 중요한 추가 서비스를 제공한다.
- 호스트 엘리어싱(host aliasing) : 복자한 호스트 네임을 가진 호스트는 하나 이상의 별칭을 가질수 있다. 정식 호스트네임과, 별칭 호스트네임으로 구분된다.
- 메일 서버 엘리어싱(mail server aliasing) : 전자 메일 주소는 기억하기 쉬운것이 좋다. DNS는 IP주소뿐 아니라 제공된 별칭 호스트 네임에 대한 정식 호스트 네임을 얻기 위해 메일 어플리케이션에 의해 수행된다. 
- 부하 분산(load Distribution) : DNS는 중복 웹 서버 같은 여러 중복 서버 사이에 부하를 분산하기 위해서도 사용이 된다. 중복 웹 서버의 경우, 여러 IP에 하나의 정식 호스트네임과 연관되어있다.
DNS데이터 베이스는 이 IP주소의 집합을 가지고 있다. 서버 IP 주소집합 전체를 가지고 질의에 응답하게 된다. DNS의 순환 방식은 여러 중복 서버들 사이에서 트래픽을 분산하는 효과를낸다.

# DNS의 동작 원리 개요
호스트 네임을 어떻게 IP주소로 변환하는지에 대한 서비스에 대해 초점을 두자.
사용자의 호스트에서 실행되는 어떤 어플리케이션이 호스트 네임을 IP로 변환 시킨다고 가정을하자.
어플리케이션은 변환될 호스트 네임을 명시하여 DNS측의 클라이언트를 호출할 것이다.
그리고 사용자 호스트의 DNS는 네트워크에 질의를 요청을 보낸다.
모든 DNS 질의와 응답 메세지는 포트 53번의 UDP 데이터 그램으로 보내진다.
수msec, sec지연후에 사용자 호스트의 DNS는 요청한 매핑에 해당하는 DNS응답을 받게된다.
이제 이 매핑은 호출한 어플리케이션으로 전달된다.
그러므로 사용자 호스트의 호출한 어플리케이션 관점에서 DNS는 간단하고 직접적인 변환 서비스를 제공하는 블랙 박스가 된다.

DNS의 간단한 설계로 모든 매핑을 포함하는 하나의 인터넷 게임 서버를 구축 할 수도 있다.
이러한 중앙 집중 방식에서 클라이언트는 모든 질의를 단일 네임 서버로 보내고, DNS 서버는 질의 클라이언트에게 직접 응답하게 된다.
이 방식은 간단하고 매력적이지만, 수많은 호스트를 가진 현대 네트워크에서는 적합하지않다.
문제점을 알아보자.
- 서버의 고장 : 만약 네임서버가 고장나면, 전체 인터넷이 동작 할 수 없다.
- 트래픽 양 : 단일 DNS서버가 모든 DNS의 질의를 처리해야한다.
- 먼거리의 중앙 집중 데이터 베이스 : 단일 DNS가 서버의 모든 질의 클라이언트로부터 "가까울"수만은 없다. 그렇기에 지연을 일으킬수 있다.
- 유지 관리 : 단일 네임 서버는 모든 인터넷 호스트에 대한 레코드를 유지해야만 한다. 이 중앙 집중 데이터 베이스는 거대해지고 모든 새로운 호스트를 반하기 위해 자주 갱신할 필요가 있다. 또한 중앙 집중 데이터 베이스는 호스트를 등록할 수 있도록 사용자에게 허용하는 것과 같은 인증 문제가있다.

## 분산 계층 데이터 베이스

확장성을 다루기 위해 DNS는 많은 서버를 이용하고, 이들을 계층 형태로 구성하며 전 세계에 분산시키게 된다.
어떠한 단일 DNS도 인터넷에 있는 모든 호스트에 대한 매핑을 가지고 있지 않다. 대신에 이러한 매핑은 DNS서버의 분산을 통해 얻어지게된다.
계층은 루트 DNS서버, 최상위 레벨 도메인 네임, 책임 DNS 서버로 이루어져있다.
먼저, 이것들이 무엇인지 알아보자.
- 루트 DNS 서버 : 인터넷에는 400개 이상의 root DNS서버가 존재한다. 
- 최상위 레벨 도메인 서버 : com, org, net, edu 같은 상위 레벨 도메인과 kr, uk,fr,ca,jp 같은 모든 국가의 상위 레벨 도메인에 대한 TLD서버
- 책임 DNS 서버 : 인터넷에서 접근하기 쉬운 호스트(ex - 웹메일, 등...)를 가진 모든 기관은 호스트 내용을 IP주소로 매핑하는 공개적인 DNS record를 제공한다. 

## DNS 캐싱
DNS의 중요한 요소중 하는 바로 캐싱(caching)이다. 실제로 DNS는 지연 성능 향상과 네트워크 DNS메세지 수를 줄이기 위해 캐싱을 사용한다.
DNS캐싱 아이디어는 매우 간단하다.
질의 사슬에서 DNS서버가 DNS응답을 요청받았을 때, 그것을 로컬 메모리에 응답에 대한 정보를 저장할수 있다.
호스트네임과 IP 주소 쌍이 DNS서버에 저장되고 다른 호스트 네임부터 같은 질의가 DNS서버로 도착한다면, DNS서버는 호스트 네임에 대한 책임이 없을때 조차 원하는 IP주소를 제공할수 있다.
호스트는 DNS와 IP주소 사이에 매핑과 호스트는 영구적인 것이 아니기 때문에 DNS 서버는 어떤 기간에 저장딘 정보를 제거하고 다시 쌓게되는 것이다.




